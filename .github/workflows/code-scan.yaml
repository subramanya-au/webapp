name: "CodeQL Scanning"

on:
  pull_request:
    branches:
      - main

jobs:
    trivy_scan:
      name: Trivy Code Scan
      runs-on: ubuntu-latest
      steps:
        - name: Checkout repository
          uses: actions/checkout@v2
      
        - name: Install Trivy
          run: |
            wget https://github.com/aquasecurity/trivy/releases/download/v0.20.0/trivy_0.20.0_Linux-64bit.tar.gz
            tar zxvf trivy_0.20.0_Linux-64bit.tar.gz
            sudo mv trivy /usr/local/bin/trivy
      
        - name: Run Trivy scan
          run: |
            trivy filesystem . --format=json > trivy_report.json
      
        - name: Upload Trivy report
          uses: actions/upload-artifact@v2
          with:
            name: trivy-report
            path: trivy_report.json